!function(n){"use strict";function e(){function n(){["_","public"].forEach(t)}function e(n,t){return Object.keys(t).forEach(function(o){"object"==typeof t[o]&&t[o]?n[o]=e("object"==typeof n[o]?n[o]:t[o]instanceof RegExp?t[o]:{},t[o]):n[o]=t[o]}),n}function t(n){var t={};o[n]=function(n,o){return"string"==typeof n?(arguments.length>1&&(t[n]=o),t[n]):("object"==typeof n&&e(t,n),t)}}var o=this;o.combine=function(n){return e(e({},o["public"]()),n||{})},n()}function t(){function n(e,t,o){setTimeout(function(){return e.length&&e.shift().apply(null,t)!==!1?n(e,t,o):void o()},0)}var e=this,t=[];e.add=function(n,e,o){return t.push({type:n,handle:e,invoke:o||1/0}),e},e.remove=function(n,e){var o=[];return t=t.filter(function(t){return n&&t.type!==n||e&&t.handle!==e?!0:(o.push(t.handle),!1)}),o},e.list=function(n){return t.filter(function(e){return!n||"*"===n||e.type===n})},e.trigger=function(t,o,i){var r=e.list(t).map(function(n){return--n.invoke<=0&&e.remove(t,n.handle),n.invoke>=0?n.handle:!1}).filter(function(n){return"function"==typeof n});arguments.length<3&&"function"==typeof arguments[arguments.length-1]&&(i=o,o=[]),n(r,o instanceof Array?o:[o],function(){i&&i()})}}function o(){function e(){var e=n.MutationObserver||n.webkitMutationObserver||!1;e&&(i={observer:e,config:{characterData:!0,characterDataOldValue:!0}})}function t(n,e){var t=typeof n;switch(t){case"boolean":return!!e;case"number":return+e}return e}function o(n,e){var o=n(),i=t(o,e);i!==o&&n(i)}var i,r=this;r.monitor=function(n,e){i?new i.observer(function(n){n.forEach(function(n){o(e,n.target.nodeValue)})}).observe(n,i.config):n.addEventListener&&n.addEventListener("DOMCharacterDataModified",function(n){o(e,n.newValue)})},e()}function i(n){function e(n){var e,t,o=[];if(3===n.nodeType)o.push(n);else for(e=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null,!1);t=e.nextNode();)o.push(t);return o}function t(e){var o=e.nodeValue.match(n),i=o?0===o.index?e:e.splitText(o.index):null,r=o?i.splitText(o[0].length):null,u=[];return i&&(u.push({node:i,key:o[2],initial:o[3]||""}),i.original=i.nodeValue),r&&(u=u.concat(t(r))),u}function o(n){var o=[];return e(n).forEach(function(n){o=o.concat(t(n))}),o}var i=this;i.placeholders=function(n,e){o(n).forEach(function(n){e.apply(null,[n.node,n.key,n.initial])})}}function r(){function n(){function e(n){return l.indexOf(n)>=0}function t(n,t){var o=s;return t||!e(n)&&!d.noquote.test(n)||(o=""),o+n+o}function o(n){return d.trailer.test(n)?o(n.substr(0,n.length-1)):n}function i(n,e){for(var o,i=[];e.length;)if(o=e.shift(),"\\"!==o[o.length-1]){if(o===n)break;i.push(o)}else d.escape.test(e[0])||(o=o.substr(0,o.length-1)),i.push(o),i.push(e.shift());return t(i.join(""))}function r(n){for(var e="";n.length;)e=u(e,n);return e}function u(n,e){var r=e.shift();switch(r){case" ":break;case"}":case"]":n=o(n)+r;break;case'"':case"'":n+=i(r,e);break;default:n+=t(r,":"===e[0])}return n}function c(n){var t,o=[];for(t=0;t<n.length;++t)0===o.length||e(n[t])||e(o[o.length-1])?o.push(n[t]):o[o.length-1]+=n[t];return o}function a(n,e){var t=":"===e?"{}":"[]",i=n.indexOf(e),r=2===(n.match(/"/g)||[]).length&&n.indexOf('"')<i&&n.lastIndexOf('"')>i;return r||n[0]===t[0]?n:t[0]+o(n)+t[1]}if("undefined"!=typeof n.prototype.__instance||!(this instanceof n))return n.prototype.__instance||new n;n.prototype.__instance=this;var f=this,l="'\":,{}[] ",s='"',d={escape:/["\\\/\b\f\n\r\t]/,noquote:/^(?:true|false|null|-?[0-9]+(?:\.[0-9]+)?)$/i,trailer:/[,]+$/};f.prepare=function(n){return"string"!=typeof n?"":r(c(n)).replace(/^.*?([:,]).*$/,a)},f.parse=function(n){var e=f.prepare(n);return e?JSON.parse(e):null}}function e(){o=new n}function t(n,e){var t,o,i=[];switch(e.nodeType){case 1:e.hasAttribute(n)&&i.push(e);case 9:case 11:for(t=e.querySelectorAll("["+n+"]"),o=0;o<t.length;++o)i.push(t[o])}return i}var o,i=this;i.find=function(n,e,i){t(n,e).forEach(function(e){i(e,o.parse(e.getAttribute(n)))})},e()}function u(){function u(){return c()?(w._({rAF:n.requestAnimationFrame||function(n){setTimeout(n,1e3/60)}}),w["public"]({greedy:!0,attribute:"data-kontext",pattern:/(\{(\$?[a-z0-9_-]+)(?::([^\}]+))?\})/i}),E.add("ready",function(n){w._("ready",n||!0)},1),void document.addEventListener("DOMContentLoaded",function(){E.trigger("ready",[void 0,x])},!1)):setTimeout(function(){E.trigger("ready",["Unsupported browser"])},0)}function c(){var n=!0;return n=n&&"addEventListener"in document,n=n&&"defineProperties"in Object,n=n&&"getOwnPropertyDescriptor"in Object}function a(n,e){Object.keys(n).forEach(function(t,o){e(t,n[t],o)})}function f(n){return Array.prototype.slice.call(n)}function l(n,e,t,o,i){var r={enumerable:t};"boolean"==typeof i?(r.writable=i,r.value=o):(r.get=o,r.set=i),Object.defineProperty(n,e,r)}function s(n,e){var t=w._("extension")||{};return e&&(t[n]=e,w._("extension",t)),n in t?t[n]:function(){console.error('Kontext: Unknown extension "'+n+'"')}}function d(n){var e=new t;return l(n,"on",!0,e.add,!1),l(n,"off",!0,e.remove,!1),"object"==typeof n&&n.on("update",function(){E.trigger("update",f(arguments))}),e}function p(n,e){var t=""+e();n.filter(function(n){return t!==n.nodeValue}).forEach(function(n){n.nodeValue=t})}function h(n){var e;return"on"in n&&"off"in n||(a(n,function(t,o){var i;y(n,t)||(i=g(o,n,t),l(n,t,!0,i,i),i.on("update",function(){e.trigger("update",[n,t,o,n[t]])})),!o||"object"!=typeof o||o instanceof Array||(h(o),o.on("update",function(o,i,r,u){e.trigger("update",[n,t+"."+i,r,u])}))}),e=d(n),l(n,"delegation",!0,function(e){return y(n,e)},!1)),n}function v(n,e){var t=Array.prototype,o=/^[0-9]+$/;a(n,function(e,i){var r;o.test(e)||e in t||m(i)||(r=g(i,n,e),l(n,e,!0,r,r))}),n.forEach(function(t,o){"object"==typeof n[o]&&(n[o]=h(t,e.model,e.key),n[o].on("update",function(){e.emission.trigger("update",[e.model,e.key,e.value])}))})}function g(n,e,t){var o=function(n){var e=arguments.length>0;return e&&(i.value=n),i.emission.trigger(e?"update":"access",[i.model,i.key,i.value,n]),i.value},i={emission:d(o),element:[],value:n,model:e,key:t};return n instanceof Array&&(["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"].forEach(function(e){var t;"function"==typeof n[e]&&(t=n[e],n[e]=function(){var e=t.apply(n,arguments);return v(n,i),i.emission.trigger("update",[i.model,i.key,i.value]),e})}),v(n,i)),o.scope=function(){!e&&arguments.length>0&&(e=arguments[0]),!t&&arguments.length>1&&(t=arguments[1])},o.element=function(){var n=f(arguments);return n.forEach(function(n){k.monitor(n,o)}),p(n,o),i.element=i.element.concat(n),i.element},i.emission.add("update",function(){w._("rAF")(function(){p(i.element,o)})}),o}function m(n){return"function"==typeof n&&"function"==typeof n.element}function y(n,e){var t,o=!1,i=e.split(".");return i.forEach(function(t,o,i){e=t,o<i.length-1&&(n=n[e])}),e in n&&(m(n[e])?o=n[e]:(t=Object.getOwnPropertyDescriptor(n,e),o=t.get)),o}function b(n,e){var t,o=w._("bindings")||[];if(!e){for(t=[n];t[t.length-1].parentNode;)t.push(t[t.length-1].parentNode);return o.filter(function(n){return t.indexOf(n.target)>=0}).map(function(n){return n.model}).filter(function(n,e,t){return e===t.indexOf(n)})}o.push({model:e,target:n}),w._("bindings",o)}var x=this,w=new e,E=new t,k=new o;x.defaults=function(n,e){return n&&w["public"](n,e),w["public"]()},x.ready=function(n){var e=w._("ready");return E.add("ready",n,1),void 0!==e&&E.trigger("ready",[e!==!0?e:void 0,e===!0?x:void 0]),x},x.on=function(n,e){return E.add(n,e)},x.off=function(n,e){return E.remove(n,e)},x.extension=s,x.delegate=function(n){return g(n)},x.bind=function(){var n=f(arguments),e=h(n.shift()),t=n.length?n.pop():{};return"nodeType"in t&&(n.push(t),t={}),t=w.combine(t),n.length<=0&&n.push(document.body),n.forEach(function(n){b(n,e),(new r).find(t.attribute,n,function(n,t){a(t,function(t,o){var i=s(t);i(n,e,o,x)})}),new i(t.pattern).placeholders(n,function(n,o,i){var r=y(e,o);r?(r.scope(e,o),r()||r(i)):t.greedy&&(r=g(i,e,o),l(e,o,!0,r,r)),r&&r.element(n)})}),e},x.bindings=function(n){return b(n||document.body)},u()}n.kontext=n.kontext||new u}(window),kontext.extension("attribute",function(n,e,t){"use strict";function o(t,o){e[o]?n.setAttribute(t,e[o]):n.hasAttribute(t)&&n.removeAttribute(t)}var i=Object.keys(t);e.on("update",function(n,e){i.forEach(function(n){t[n]===e&&o(n,e)})}),i.forEach(function(n){o(n,t[n])})}),kontext.extension("css",function(n,e,t){"use strict";function o(t,o){var i=!!e[o];"classList"in n?n.classList[i?"add":"remove"](t):n.className=n.className.replace(new RegExp("(?:^|\\s+)"+o+"(\\s+|$)"),function(n,e){return e||""})+(i?" "+t:"")}var i=Object.keys(t);e.on("update",function(n,e){i.forEach(function(n){t[n]===e&&o(n,e)})}),i.forEach(function(n){o(n,t[n])})}),kontext.extension("each",function(n,e,t){"use strict";function o(n){var o;return["map","filter"].forEach(function(i){i in t&&(o=t[i]instanceof Array?t[i]:[t[i]],o.forEach(function(t){if("function"==typeof e[t])n=n[i](e[t]);else{if("function"!=typeof window[t])throw new Error(t+" is not a "+i+" function");n=n[i](window[t])}}))}),n}function i(n){var e=s.filter(function(e){return e.item===n});return e.length?e[0]:null}function r(n){var o,r=i(n);return r||(o=l.map(function(n){return n.cloneNode(!0)}),r={item:n,model:kontext.bind.apply(kontext,["object"==typeof n?n:{}].concat(o)),nodes:o},r.model.$index=null,r.model.$item=n,r.model.$parent=e[t],s.push(r)),r}function u(n,e){return n.length!==e.length||0!==n.filter(function(n,t){return e[t]!==n}).length}function c(){var i,c=[],l=e[a],s=!1;if("object"==typeof t&&(l=o(l),i=!0),(!f||u(f,l))&&(f=l.slice(),s=!0),s||i){for(l.forEach(function(n,e){var t=r(n);t.model.$index=e,c=c.concat(t.nodes)});n.lastChild;)n.removeChild(n.lastChild);c.forEach(function(e){n.appendChild(e)})}}var a,f,l=[],s=[];if("object"==typeof t){if(a=t.target||!1,!a)throw new Error('Missing target for "each"')}else a=t;for(;n.firstChild;)l.push(n.removeChild(n.firstChild).cloneNode(!0));e.on("update",function(n,e){e===a&&c()}),c()}),kontext.extension("event",function(n,e,t){"use strict";function o(t,o,i){n.addEventListener(t,function(n){var t=e.delegation(o),r=t?t():!1;t&&("function"==typeof r?r.apply(null,[n,e,o,i]):t(i))},!1)}function i(n,e){"object"==typeof e?(e instanceof Array?e:Object.keys(e)).forEach(function(t){o(n,t,t in e?e[t]:void 0)}):o(n,e)}Object.keys(t).forEach(function(n){i(n,t[n])})}),kontext.extension("html",function(n,e,t){"use strict";e.delegation(t).on("update",function(e){n.innerHTML=e[t]}),n.innerHTML=e[t]}),kontext.extension("input",function(n,e,t){"use strict";function o(n){return n.hasAttribute("type")?n.getAttribute("type"):a.test(n.nodeName)?"select-"+(n.multiple?"multiple":"one"):"text"}function i(e){return e in f||(f[e]={model:function(){c(n[e])},element:function(t,o){n[e]=t[o]}}),f[e]}function r(){var o="default"in t?{value:null,label:t["default"]}:!1,i=function(){var i,r=0;"options"in t&&(i=e.delegation(t.options))&&(i=i(),o&&(n.options[r]=new Option(o.label,o.value),++r),n.options.length=r,"object"==typeof i&&(i instanceof Array?i.forEach(function(e,t){"object"==typeof e?n.options[t+r]=new Option(e.label||e.value||"",e.value||""):n.options[t+r]=new Option(e)}):Object.keys(i).forEach(function(e,t){n.options[t+r]=new Option(i[e],e)})))},r=function(e){var t;for(t=0;t<n.options.length;++t)e instanceof Array?n.options[t].selected=e.indexOf(n.options[t].value)>=0:n.options[t].selected=n.options[t].value===e},u="options"in t?e.delegation(t.options):!1,c="value"in t?e.delegation(t.value):!1,a=c?c():null;c&&(a instanceof Array?n.setAttribute("multiple",""):n.removeAttribute("multiple"),n.addEventListener("change",function(){var o,i;if(n.options.length)if(a instanceof Array)for(o=0;o<n.options.length;++o)n.options[o].selected&&e[t.value].indexOf(n.options[o].value)<0?e[t.value].push(n.options[o].value):!n.options[o].selected&&(i=e[t.value].indexOf(n[o].value))>=0&&e[t.value].splice(i,1);else c(n.options[n.selectedIndex].value)},!1),c.on("update",function(n,e){r(n[e])})),(u||c)&&(i(),r(a))}var u,c,a=/^select/i,f={};switch(o(n)){case"checkbox":case"radio":u="checked";break;case"select":case"select-one":case"select-multiple":r();break;default:u="value"}u&&(c=e.delegation(t[u]),c&&(n.addEventListener("input",i(u).model,!1),n.addEventListener("change",i(u).model,!1),c.on("update",i(u).element),n[u]=c()))}),kontext.extension("attribute",function(n,e,t){"use strict";function o(t,o){e[o]?n.setAttribute(t,e[o]):n.hasAttribute(t)&&n.removeAttribute(t)}var i=Object.keys(t);e.on("update",function(n,e){i.forEach(function(n){t[n]===e&&o(n,e)})}),i.forEach(function(n){o(n,t[n])})}),kontext.extension("each",function(n,e,t){"use strict";function o(n){var o;return["map","filter"].forEach(function(i){i in t&&(o=t[i]instanceof Array?t[i]:[t[i]],o.forEach(function(t){if("function"==typeof e[t])n=n[i](e[t]);else{if("function"!=typeof window[t])throw new Error(t+" is not a "+i+" function");n=n[i](window[t])}}))}),n}function i(n){var e=s.filter(function(e){return e.item===n});return e.length?e[0]:null}function r(n){var o,r=i(n);return r||(o=l.map(function(n){return n.cloneNode(!0)}),r={item:n,model:kontext.bind.apply(kontext,["object"==typeof n?n:{}].concat(o)),nodes:o},r.model.$index=null,r.model.$item=n,r.model.$parent=e[t],s.push(r)),r}function u(n,e){return n.length!==e.length||0!==n.filter(function(n,t){return e[t]!==n}).length}function c(){var i,c=[],l=e[a],s=!1;if("object"==typeof t&&(l=o(l),i=!0),(!f||u(f,l))&&(f=l.slice(),s=!0),s||i){for(l.forEach(function(n,e){var t=r(n);t.model.$index=e,c=c.concat(t.nodes)});n.lastChild;)n.removeChild(n.lastChild);c.forEach(function(e){n.appendChild(e)})}}var a,f,l=[],s=[];if("object"==typeof t){if(a=t.target||!1,!a)throw new Error('Missing target for "each"')}else a=t;for(;n.firstChild;)l.push(n.removeChild(n.firstChild).cloneNode(!0));e.on("update",function(n,e){e===a&&c()}),c()}),kontext.extension("each",function(n,e,t){"use strict";function o(n){var o;return["map","filter"].forEach(function(i){i in t&&(o=t[i]instanceof Array?t[i]:[t[i]],o.forEach(function(t){if("function"==typeof e[t])n=n[i](e[t]);else{if("function"!=typeof window[t])throw new Error(t+" is not a "+i+" function");n=n[i](window[t])}}))}),n}function i(n){var e=s.filter(function(e){return e.item===n});return e.length?e[0]:null}function r(n){var o,r=i(n);return r||(o=l.map(function(n){return n.cloneNode(!0)}),r={item:n,model:kontext.bind.apply(kontext,["object"==typeof n?n:{}].concat(o)),nodes:o},r.model.$index=null,r.model.$item=n,r.model.$parent=e[t],s.push(r)),r}function u(n,e){return n.length!==e.length||0!==n.filter(function(n,t){return e[t]!==n}).length}function c(){var i,c=[],l=e[a],s=!1;if("object"==typeof t&&(l=o(l),i=!0),(!f||u(f,l))&&(f=l.slice(),s=!0),s||i){for(l.forEach(function(n,e){var t=r(n);t.model.$index=e,c=c.concat(t.nodes)});n.lastChild;)n.removeChild(n.lastChild);c.forEach(function(e){n.appendChild(e)})}}var a,f,l=[],s=[];if("object"==typeof t){if(a=t.target||!1,!a)throw new Error('Missing target for "each"')}else a=t;for(;n.firstChild;)l.push(n.removeChild(n.firstChild).cloneNode(!0));e.on("update",function(n,e){e===a&&c()}),c()}),kontext.extension("text",function(n,e,t){"use strict";var o=n.firstChild&&3===n.firstChild.nodeType?n.firstChild:document.createTextNode(e[t]),i=e.delegation(t);i&&(o.parentNode!==n&&o!==n.firstChild&&n.insertBefore(o,n.firstChild),i.element(o))});
//# sourceMappingURL=kontext.min.js.map
